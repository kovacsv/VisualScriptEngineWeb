<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="content-type" content="text/html;charset=utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no">
	
	<script type="text/javascript" src="jquery/jquery-3.5.1.min.js"></script>

	<link rel="stylesheet" type="text/css" href="style/style.css">
	<script type="text/javascript" src="script/modaldiv.js"></script>
	<script type="text/javascript" src="script/contextmenu.js"></script>
	<script type="text/javascript" src="script/nodetree.js"></script>
	<script type="text/javascript" src="script/application.js"></script>
	
	<script type='text/javascript'>
		var application = new Application ();

		function ContextMenuRequest (mouseX, mouseY, commandsJsonFromCpp)
		{
			var commandsJsonStr = UTF8ToString (commandsJsonFromCpp);
			var commandJson = JSON.parse (commandsJsonStr);
			
			var canvasDiv = $('#canvas');
			var positionX = canvasDiv.offset ().left + mouseX
			var positionY = canvasDiv.offset ().top + mouseY;
			
			application.ContextMenuRequest (positionX, positionY, commandJson);
		}
		
		function OnDoubleClick (mouseX, mouseY)
		{
			// TODO: handle double click
		}		

		function OnResize ()
		{
			var windowObj = $(window);
			var newWidth = windowObj.width () - 240 - 12;
			var newHeight = windowObj.height () - 22;
			application.ResizeCanvas (newWidth, newHeight);
		}
		
		function OnReady ()
		{
			application.InitMenu ('menu');
		}

		function OnRuntimeInitialized (module)
		{
			var canvasDiv = $('#canvas');
			application.InitCanvas (canvasDiv)
			application.InitModule (Module);
		}
		
		function OnWindowCreated ()
		{
			OnResize ();
		}
		
		$(window).resize (function () {
			OnResize ();
		});
		
		$(document).ready (function () {
			OnReady ();
		});
	</script>
</head>

<body>
	<div class="editor">
		<div class="left" id="left">
			<div class="leftcontainer" id="leftcontainer">
				<div class="menu" id="menu"></div>
				<div class="links nomobile">
					<a href="https://github.com/kovacsv/VisualScriptEngineWeb"><img src="images/github.png"/></a>
				</div>
			</div>
		</div>
		<canvas id="canvas" tabindex="1" oncontextmenu="event.preventDefault ()"></canvas>
	</div>
	<script type='text/javascript'>
		var Module = {
			onRuntimeInitialized : function () {
				OnRuntimeInitialized ();
			},
			canvas : (function () {
				return document.getElementById ('canvas');
			}) ()
		};
	</script>
	<script src="WebApp.js"></script>
</body>

</html>
